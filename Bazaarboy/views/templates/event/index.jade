// Event

extends ../layout

block title
    | {{ event.name }}

append head
    {% if event.is_private %}
    meta(name="robots", content="noindex,nofollow")
    {% endif %}
    link(rel="stylesheet", href="{{ STATIC_URL }}jQueryUI/jquery-ui.css")
    link(rel="stylesheet", href="{{ STATIC_URL }}redactor/redactor.css")

block vars
    - var collapsed = true

prepend body
    {% if not user.fb_id %}
    include ../components/facebook
    {% endif %}

block content
    div#event.content_divided.event_base(class="{% if event.cover %}big_cover {% if editable %}with_caption{% endif %}{% endif %}")
        div.cover
            div.image
                div.bounds
                    {% if event.cover %}
                    img.normal(src="{{ event.cover.source.url }}")
                    {% endif %}
            div.caption
                div.inner
                    div.text
                        {% if event.cover and event.cover.caption|length != 0 %}
                        {{ event.cover.caption }}
                        {% else %}
                        i No caption yet.
                        {% endif %}
                    {% if event.cover and editable %}
                    div.button Edit
                    div.editor.hidden
                        input(type="text", name="caption", placeholder="Maximum 100 Characters", value="{{ event.cover.caption }}")
                    {% endif %}
            {% if editable %}
            div.controls(class="{% if not event.cover %}stick{% endif %}")
                span.hidden Drag the image to position you think fit. 
                a.edit(href="javascript:;") 
                    | {% if event.cover %}Edit Cover{% else %}Add Cover{% endif %}
                a.delete(href="javascript:;", class="{% if not event.cover %}hidden{% endif %}") 
                    | Delete
                a.hidden.save(href="javascript:;") Save
                a.hidden.cancel(href="javascript:;") Cancel
                form.upload_cover
                    input.hidden(type="file", name="image_file")
                    {% csrf_token %}
            {% endif %}
        div.title
            div.inner
                div.text
                    {{ event.name }}
                {% if editable %}
                div.button Edit
                div.editor.hidden
                    input(type="text", name="name", placeholder="Event name", value="{{ event.name }}")
                {% else %}
                div.controls
                {% endif %}
                div.clear
        div.frame
            div.left
                div.description
                    div.editor
                        div.inner
                            {{ event.description|safe }}
                    {% if editable %}
                    div.controls
                        a.save(href="javascript:;") Save
                        a.edit(href="javascript:;") Edit
                    {% endif %}
            div.right
                div.action
                    div.button
                        {% if editable %}
                        b Edit Tickets
                        {% else %}
                        b RSVP
                        {% endif %}
                    div.price
                    div.clear
                div.details.info
                    div.time
                        //- Format the times to form something like this
                        //- Jul 9th, 10pm - 11pm
                        //- or
                        //- Jul 9th, 10am - Jul 10th, 11pm
                        | {% spaceless %}
                        | {{ event.start_time|date:"M jS, f" }}{{ event.start_time|date:"A"|lower }}
                        | {% if event.end_time %}
                        | {% if event.end_time|shouldShortenEndTime:event.start_time %}
                        |  - {{ event.end_time|date:"f" }}{{ event.end_time|date:"A"|lower }}
                        | {% else %}
                        |  - 
                        br
                        | {{ event.end_time|date:"M jS, f" }}{{ event.end_time|date:"A"|lower }}
                        | {% endif %}
                        | {% endif %}
                        | {% endspaceless %}
                    {% if event.location|length != 0 %}
                    div.location 
                        div.text
                            | at 
                            b {{ event.location }}
                        //div.map(data-latitude="{{ event.latitude }}", data-longitude="{{ event.longitude }}")
                        //    div#map_canvas
                    {% endif %}
                div.facebook.info
                    {% if editable %}
                    div.caption
                        div.text Sync to Facebook
                        div.clear
                    div.content
                    {% else %}
                    div.caption
                        div.text Friends Going
                        {% if user.fb_id %}
                        div.share
                            b Share
                        {% endif %}
                        div.clear
                    div.content
                        {% if user.fb_id %}
                        {% else %}
                        {% endif %}
                    {% endif %}
                div.organizers.info
                    div.caption
                        div.text Organizer
                        div.clear
                    div.body
                        div.organizer
                            div.icon
                            div.name
                                a(href="{% url profile:index event.owner.id %}")
                                    | {{ event.owner.name }}
                div.summary.info
                    div.caption
                        div.text Summary
                        {% if editable %}
                        div.button Edit
                        {% endif %}
                        div.clear
                    div.body
                        div.text
                            {% if event.summary|length != 0 %}
                            {{ event.summary }}
                            {% else %}
                            | No summary yet.
                            {% endif %}
                        {% if editable %}
                        div.editor.hidden
                            textarea(name="summary", placeholder="Maximum 100 Characters")
                                | {{ event.summary }}
                        {% endif %}
                div.tags.info
                    div.caption
                        div.text Tags
                        {% if editable %}
                        div.button Edit
                        {% endif %}
                        div.clear
                    div.body
                        div.text
                            {% if event.tags|length != 0 %}
                            {% for tag in event.tags|split:"," %}
                            div.tag {{ tag }}
                            {% endfor %}
                            div.clear
                            {% else %}
                            | No tags yet.
                            {% endif %}
                        {% if editable %}
                        div.editor.hidden
                            textarea(name="tags", placeholder="Max. 50 Chars. Separate by comma")
                                | {{ event.tags }}
                        {% endif %}
            div.clear
        div.sponsors
            div.caption
                div.text Sponsors
                div.clear
        div.others
            div.similar
            div.nearby
            div.recommendation
            div.clear
    {% if editable %}
    div#tickets.event_overlay_canvas
        div.title Edit RSVP Options
        div.controls
            a.add(href="javascript:;") Add RSVP Option
        mixin ticket(id, name, description, price, quantity, start_time, end_time)
            div.ticket(class=attributes.class, data-id=id)
                form
                    div.name
                        div.text= name
                        div.editor
                            input(type="text", name="name", placeholder="Name", value=name)
                    div.description
                        div.text= description
                        div.editor
                            input(type="text", name="description", placeholder="Short description", value=description)
                    div.price
                        div.text= '$ ' + price
                        div.editor
                            input(type="text", name="price", placeholder="Price", value=price)
                    div.quantity
                        div.text= quantity
                        div.editor
                            input(type="text", name="quantity", placeholder="Quantity (Unlimited if left blank)", value=quantity)
                    div.start_time
                        div.text= start_time
                        div.editor
                            input(type="text", name="start_time", placeholder="Start time", value=start_time)
                    div.end_time
                        div.text= end_time
                        div.editor
                            input(type="text", name="end_time", placeholder="End time", value=end_time)
                    div.buttons
                        a.switch.edit(href="javascript:;") Edit
                        a.delete(href="javascript:;") Delete
        +ticket()(class="template hidden")
        div.tickets
            {% for ticket in tickets %}
            +ticket('{{ ticket.id }}', '{{ ticket.name }}', '{{ ticket.description }}', '{{ ticket.price|floatformat:-2 }}', '{{ ticket.quantity }}', '{{ ticket.start_time|standardTime }}', '{{ ticket.end_time|standardTime }}')
            {% endfor %}
            div.empty(class="{% if tickets|length != 0 %}hidden{% endif %}")
                i No RSVP options yet.
    {% else %}
    div#rsvp.event_overlay_canvas
        {% if not user %}
        div.user
            div.caption Do you have a Bazaarboy account?
            div.normal
                div.login
                    div.caption Log In
                    div.form
                        form.login
                            input(type="text", name="email", placeholder="Email")
                            input(type="password", name="password", placeholder="Password")
                            input(type="submit", value="Log In")
                div.divider
                div.register
                    div.caption Register
                    div.form
                        form.register
                            input(type="text", name="full_name", placeholder="Your Name")
                            input(type="text", name="email", placeholder="Email")
                            input(type="password", name="password", placeholder="Password")
                            input(type="submit", value="Register")
                            input(type="hidden", name="city", value="{{ event.city.id }}")
                div.clear
        div.divider or
        div.email
            input(type="text", name="email", placeholder="Email")
        {% endif %}
        div.tickets
        div.action
        div.checkout
    {% endif %}

append script
    //script(type="text/javascript", src="https://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyBb4LqJdxCDjVWlgqLsdgtMpiI3fFloTiw")
    script(type="text/javascript", src="{{ STATIC_URL }}jQueryUI/jquery-ui.min.js")
    script(type="text/javascript", src="{{ STATIC_URL }}redactor/redactor.min.js")
    script(type="text/javascript").
        var eventId = {{ event.id }};
        var editable = {% if editable %}true{% else %}false{% endif %};
        var token{% if params.token %} = '{{ params.token }}'{% endif %};
    script(type="text/javascript", src="{{ STATIC_URL }}js/event/index.js")